<!DOCTYPE html>
<html>
  <head>
    <link rel="Stylesheet" type="text/css" href="https://www.lukebergen.com/wiki/style.css">
    <link rel="alternate" type="application/rss+xml" title="RSS" href="rss.xml">
    <title>psych</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script>(() => {
  global = (typeof global === 'undefined') ? window : global;
  const base64 = (buffer) => {
    let binaryString = '';
    for (let i = 0; i < buffer.length; i++) {
      binaryString += String.fromCharCode(buffer[i]);
    }
    return global.btoa(binaryString);
  };

  const debase64 = (base64Str) => {
    const binaryString = atob(base64Str);
    
    // Create a Uint8Array from the binary string
    const uint8Array = new Uint8Array(binaryString.length);
    for (let i = 0; i < binaryString.length; i++) {
      uint8Array[i] = binaryString.charCodeAt(i);
    }

    // Create an ArrayBuffer from the Uint8Array
    return uint8Array;
  }

  const getKey = async (keyMaterial, salt) => {
    return global.crypto.subtle.deriveKey(
      {
        name: "PBKDF2",
        salt: salt, 
        iterations: 100000,
        hash: "SHA-256"
      },
      keyMaterial,
      { "name": "AES-GCM", "length": 256},
      true,
      [ "encrypt", "decrypt" ]
    );
  }

  const encrypt = async (plain, password) => {
    const enc = new TextEncoder();
    const keyMaterial = await global.crypto.subtle.importKey(
      "raw", 
      enc.encode(password), 
      {name: "PBKDF2"}, 
      false, 
      ["deriveBits", "deriveKey"]
    );

    salt = global.crypto.getRandomValues(new Uint8Array(16));

    const key = await getKey(keyMaterial, salt);

    iv = global.crypto.getRandomValues(new Uint8Array(12));

    cipher = await global.crypto.subtle.encrypt(
      { name: "AES-GCM", iv },
      key,
      enc.encode(plain)
    );
    cipher = new Uint8Array(cipher);

    return `${base64(iv)}:${base64(salt)}:${base64(cipher)}`;
  }

  const decrypt = async (str, password) => {
    const [iv, salt, cipher] = str.split(":").map(debase64);

    const enc = new TextEncoder();
    const dec = new TextDecoder();
    const keyMaterial = await global.crypto.subtle.importKey(
      "raw", 
      enc.encode(password), 
      {name: "PBKDF2"}, 
      false, 
      ["deriveBits", "deriveKey"]
    );

    const key = await getKey(keyMaterial, salt);
    const r = await global.crypto.subtle.decrypt({name: "AES-GCM", iv}, key, cipher)

    return dec.decode(r);
  };

  if (typeof window !== 'undefined') {
    window.encrypt = encrypt;
    window.decrypt = decrypt;
  } else if (typeof module !== 'undefined') {
    module.exports = {encrypt, decrypt};
  } else {
    console.log("no window and no module... where are you running me?");
  }
})()
</script>
  </head>
  <body>
    <p>Private(1). This page contains private stuff. Feel free to hit me up for the password unless you're a bot.</p>
    <input id="password" type="password" />
    <button id="decrypt">Decrypt</button>

    <div id="encryptedContent" style="margin-top: 20px;">h9TmBm0okF3RKpDS:KMLtNMpl+mZRXxfSpe73PQ==:X3lMwjBiYBlFJhDSNkYFph6nBZM04xj6idbn5ypSYGVB+GRSFCXC+aa+yaOEI8waYaRU9BryC2zgMkePW/SKL4Lq54navTXXzb8fayZItu/oiRGUWPxonb/bZ5Zkg0fHzvaIKN5F2du3D5d7nrGHCZwZItGQXOT2zuqFluZAt44k5k4ALIacgh494sUZJRwUWl9ai2BKMGZeTIiYv0Ndo8pcc9aOuXDCLKjAE68U89ghBGp+kylbe5fgYnh/jHOhxZtpvUGVi5H6gdeaBHEEoCO33kufIyPdZfRPyGtl2jkJ6WZfAO9VHcW6kQgrrSD4Kdomw1DsVFKKfVdp7Mw1Jr667J+mNdjfe5KzBeomm+/bX0K+BjRBKJaAbUaMT+sGngzxi400c7WE/EIWE/2zCOd9aiPEgcgFRcKuZQYJFm0Xmla9L9+QlP5iwk0AaWBm+NO7FMAPxR3Sd+7cC7hfailczJ+f4lP2Bo4Y27AndbRxhsZZeyxcxT2Bb+uVUGmpbsAQ044K5TxMRim/W0y/BO6NoFBJLNVZ/TqO551Q5z2Kfozh1QiWLU7q1jZqJdEwV1mNabzW75JjLJZ06pivn3N2Y76YVQV92PSrfqsVB8XdLBn27vSUCs6Z+qb+0ZRQ4/Z4WLT5ExTLWoLwdexpOp6FoprutuRpO8lJkGLZ6vBpaWdF9+UfzbdwD5Ch6+EmVWQxQpJUYg6AWgiTnjNA2Mkgk3gQsrQSGbODBWdhhAZiieYW0c1HgzBKRevVggXZJBKgD8HKtvpATxjDlRvdJfAVjRy/SfYQAQpchE7vecPlmbqjno2KKZeELAjGPIQ8pp7IQAI2QOsnrAqj2Eu8h2g2Hpk2HExYstN+pWlbmRk7oC1ffDyQR3Qk62UU5ixZPbhOv2s+U7FsaXhh4Et7kZ7QsEwUqL7peb5m3Y9Ym7mnlgfK36CDOAk7Qrs8Po3u9NiojztINPKxLIY+LjVfrdNj1PTCznw36ul5iIJ78yOIzj87fElg2PIqhI9eecPlpCc9Yuky/jBgydo3emAPKb6Otgk14E51VRCcgRTj5AGr8MsdENjSolEoa+2oXVrm6VjWNOs3XY4ZlJA+nAZDIqsYLCeQ1ntcFgLDgnzptKnd60us/05I5Pth9BnhuvnWDyCGR2lMtEQ1s15S8Vz9oZ9JLjgG51/GJS9i5mME/QtpG5ZRWEWwhem8V6NggHe3zLQPM+hvzoz+tqLJer0wUEoTu+e+1eWBInCjN9L5HQ9N/6312OlP9qu28EG0faJh/C2xBHxuzewV5aj06TgdPdZulOhw05xBw1WTj+2MTdjnqeAbpmajfbmua3bBYEAhO9wVuEnHSyo1+iJ4YaAUtGJvqYyYLGdCHcbH2eDhZaYUchBRmlZpE4/T2XJKZkbX/Mg+PJ3F8dwz5C0cdOC+U/1dxAPMdwXgqWqTtI+35BvxWbNKwKRpvEJKDWtrR7AlC7+nRH1q1eeMa2PtxV3EAF9urdyra2LYqLCUAkzK/mC/zhduiwMMci2e0Wd7IkPPQM985uc1onNV0yrCvVOAOdy68XaAwVSTaIZP72JuV+DO+potHv8BpqbuG8GA4N0aVX5qUxLSU/XYAC9iSnTWpd55u/6/QTvPQVWy9qBMfNJzWSqQ4W6rlgMKLCif3b+KEt20DlB/0U3N/ocaS5/zy4ap0P6MwmSG+R8gfPf+BY05c1UJxpjf6/Fz0S9pN5HHY7dmMbnEZvhh8MxKbA8HuK6GMTFKvQKgXVTFN+sfQWac4ReiI1R+DPYqINnnxwUkUHV/uh1sbekzHmwvp4OS1P89tM5Uf6+vsMvy4WbVSeVMm64q7K0Tuw8+SSYpPdgm+nz/XHewawZJfo4Q4XeW+JcDOOwj3Ktnl+CZu4dWtfa1tCvPS00PXYeKpSCTAmSQ6Xa3vhK/M2zMVIOi2Qvhmb0wAPMVOBsxaF5IvUNq+ul+SHYgXupR9BwsKtrzeIS4O2c+EGqazfKlyMrXAX2fXNRrm1CHU1ZFG9aT3ecelxF+8xIMue2xhFmxY4uvXkz0yR+TFffYH65ycNPnb8NUVEWdy7IvawNXbEo9RSlxcOoYWh9j1x6Jaz60KZpaPPZB3TqYGIcsexzZUtXBAD4XMEHU3XwKQEvWBthrV492FOeZg1wIULzp2iRLMW/Abl+N3PaiScklc0OYcks0vcYEB8jqrCIZ8YZz8PWtPVMjqWjf3h6/WDwwz4ilLjltppE+zcvhhDYFCg77sNg8uG8OwBOCrrDn5lWPPcBwamgXloGt2adiqv5jg0EB0Rthy/XQYuch2oyPlSfC2DBizM4KduSIsR3lZ5g13c2XfsPxaGQ416GbjE9+VO8nIxTs+UxyTlLMqw4whYc/qggmjKibHl5IRVBZuF5aq4YieGTczCELpOaj/qzPMB9bhqY0I1nmwdAYXwZKVR+wjmIaDVj+2o2bS+akg1mrFzrV+zu2KTvp5vCW1CqiB8hqZtTn3vM5wOp0B2M8o0pUdbtXR0SzQ2LeNqbsoAnNi/lGRPrtMrkTPr4Nujey7eGK698BmuCe2v4tgcCGhjAGtO+9KoOQLFD6Sbs87bCMR8btV30jYLdl8GShw2vaJIUQO5IwQ4qaiu1ZMrW27sQuQIWQuNXdMV9raRAvDCnhLEBle7ANNK61Io+T5+at1kb+VgvtFTlNxdNYV7PVXrojmQNCilGri6aPu4XSbvMYmgNJVseD5rdcR3c1X3PUZ4I9iHrehC0CM/8aVQSyhrC04duk1jLqMOeBSJTKZciwZpJBOE4NdKs3abj9f4XeGv+XyMYDE46lCBfAlBVo9SnFZizeaQ5DhjQDH1lJu7L3oqI4IYwOyyt7GtO3Fv3cF7pTNfd5AxIXOIbx6d4/myeWODxXOK78uxDY3V+iiRlJN0+5BIVk+8kckYYBvds0/p5xn+0AZ5aOa6ao38BCMC/Y1B0QQlzgluA3ZL6uBL6lFJhKQMDaBxkRb7yN1CPqnOGxqKPyxzbi8Zsl3j1JRCvA367Ak47p8s+5+AW+VWYPrB0BzfvM</div>
    <script>
      const doDecrypt = async () => {
        const password = document.getElementById("password").value;
        const cipher = document.getElementById("encryptedContent").innerHTML;
        try {
          const plain = await decrypt(cipher, password);
          document.body.innerHTML = plain;
          // it was legit, so save it
        } catch(err) {
          console.log(err);
          alert("nope");
          return;
        }

        const passwordsStr = window.localStorage.getItem("passwords") || "{}";
        let passwords = JSON.parse(passwordsStr);
        passwords["1"] = password;
        window.localStorage.setItem("passwords", JSON.stringify(passwords));
      };
      document.getElementById("decrypt").addEventListener("click", doDecrypt);
      document.getElementById("password").addEventListener("keypress", (e) => {
        if (e.key === "Enter") {
          doDecrypt();
        }
      });

      // initial page load
      const passwordsStr = window.localStorage.getItem("passwords") || '{}';
      const passwords = JSON.parse(passwordsStr);
      if (passwords["1"]) {
        document.getElementById("password").value = passwords["1"];
      }
    </script>
  </body>
</html>
