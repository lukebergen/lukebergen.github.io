<!DOCTYPE html>
<html>
  <head>
    <link rel="Stylesheet" type="text/css" href="https://www.lukebergen.com/wiki/style.css">
    <link rel="alternate" type="application/rss+xml" title="RSS" href="rss.xml">
    <title>psych</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script>(() => {
  global = (typeof global === 'undefined') ? window : global;
  const base64 = (buffer) => {
    let binaryString = '';
    for (let i = 0; i < buffer.length; i++) {
      binaryString += String.fromCharCode(buffer[i]);
    }
    return global.btoa(binaryString);
  };

  const debase64 = (base64Str) => {
    const binaryString = atob(base64Str);
    
    // Create a Uint8Array from the binary string
    const uint8Array = new Uint8Array(binaryString.length);
    for (let i = 0; i < binaryString.length; i++) {
      uint8Array[i] = binaryString.charCodeAt(i);
    }

    // Create an ArrayBuffer from the Uint8Array
    return uint8Array;
  }

  const getKey = async (keyMaterial, salt) => {
    return global.crypto.subtle.deriveKey(
      {
        name: "PBKDF2",
        salt: salt, 
        iterations: 100000,
        hash: "SHA-256"
      },
      keyMaterial,
      { "name": "AES-GCM", "length": 256},
      true,
      [ "encrypt", "decrypt" ]
    );
  }

  const encrypt = async (plain, password) => {
    const enc = new TextEncoder();
    const keyMaterial = await global.crypto.subtle.importKey(
      "raw", 
      enc.encode(password), 
      {name: "PBKDF2"}, 
      false, 
      ["deriveBits", "deriveKey"]
    );

    salt = global.crypto.getRandomValues(new Uint8Array(16));

    const key = await getKey(keyMaterial, salt);

    iv = global.crypto.getRandomValues(new Uint8Array(12));

    cipher = await global.crypto.subtle.encrypt(
      { name: "AES-GCM", iv },
      key,
      enc.encode(plain)
    );
    cipher = new Uint8Array(cipher);

    return `${base64(iv)}:${base64(salt)}:${base64(cipher)}`;
  }

  const decrypt = async (str, password) => {
    const [iv, salt, cipher] = str.split(":").map(debase64);

    const enc = new TextEncoder();
    const dec = new TextDecoder();
    const keyMaterial = await global.crypto.subtle.importKey(
      "raw", 
      enc.encode(password), 
      {name: "PBKDF2"}, 
      false, 
      ["deriveBits", "deriveKey"]
    );

    const key = await getKey(keyMaterial, salt);
    const r = await global.crypto.subtle.decrypt({name: "AES-GCM", iv}, key, cipher)

    return dec.decode(r);
  };

  if (typeof window !== 'undefined') {
    window.encrypt = encrypt;
    window.decrypt = decrypt;
  } else if (typeof module !== 'undefined') {
    module.exports = {encrypt, decrypt};
  } else {
    console.log("no window and no module... where are you running me?");
  }
})()
</script>
  </head>
  <body>
    <p>Private(1). This page contains private stuff. Feel free to hit me up for the password unless you're a bot.</p>
    <input id="password" type="password" />
    <button id="decrypt">Decrypt</button>

    <div id="encryptedContent" style="margin-top: 20px;">Kc/tL+y5vaMqTsYv:T8F3Edsu9ZlQvxGl1ClTzg==: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</div>
    <script>
      const doDecrypt = async () => {
        const password = document.getElementById("password").value;
        const cipher = document.getElementById("encryptedContent").innerHTML;
        try {
          const plain = await decrypt(cipher, password);
          document.body.innerHTML = plain;
          // it was legit, so save it
        } catch(err) {
          console.log(err);
          alert("nope");
          return;
        }

        const passwordsStr = window.localStorage.getItem("passwords") || "{}";
        let passwords = JSON.parse(passwordsStr);
        passwords["1"] = password;
        window.localStorage.setItem("passwords", JSON.stringify(passwords));
      };
      document.getElementById("decrypt").addEventListener("click", doDecrypt);
      document.getElementById("password").addEventListener("keypress", (e) => {
        if (e.key === "Enter") {
          doDecrypt();
        }
      });

      // initial page load
      const passwordsStr = window.localStorage.getItem("passwords") || '{}';
      const passwords = JSON.parse(passwordsStr);
      if (passwords["1"]) {
        document.getElementById("password").value = passwords["1"];
      }
    </script>
  </body>
</html>
