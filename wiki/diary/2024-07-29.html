<!DOCTYPE html>
<html>
  <head>
    <link rel="Stylesheet" type="text/css" href="https://www.lukebergen.com/wiki/style.css">
    <link rel="alternate" type="application/rss+xml" title="RSS" href="rss.xml">
    <title>psych</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script>(() => {
  global = (typeof global === 'undefined') ? window : global;
  const base64 = (buffer) => {
    let binaryString = '';
    for (let i = 0; i < buffer.length; i++) {
      binaryString += String.fromCharCode(buffer[i]);
    }
    return global.btoa(binaryString);
  };

  const debase64 = (base64Str) => {
    const binaryString = atob(base64Str);
    
    // Create a Uint8Array from the binary string
    const uint8Array = new Uint8Array(binaryString.length);
    for (let i = 0; i < binaryString.length; i++) {
      uint8Array[i] = binaryString.charCodeAt(i);
    }

    // Create an ArrayBuffer from the Uint8Array
    return uint8Array;
  }

  const getKey = async (keyMaterial, salt) => {
    return global.crypto.subtle.deriveKey(
      {
        name: "PBKDF2",
        salt: salt, 
        iterations: 100000,
        hash: "SHA-256"
      },
      keyMaterial,
      { "name": "AES-GCM", "length": 256},
      true,
      [ "encrypt", "decrypt" ]
    );
  }

  const encrypt = async (plain, password) => {
    const enc = new TextEncoder();
    const keyMaterial = await global.crypto.subtle.importKey(
      "raw", 
      enc.encode(password), 
      {name: "PBKDF2"}, 
      false, 
      ["deriveBits", "deriveKey"]
    );

    salt = global.crypto.getRandomValues(new Uint8Array(16));

    const key = await getKey(keyMaterial, salt);

    iv = global.crypto.getRandomValues(new Uint8Array(12));

    cipher = await global.crypto.subtle.encrypt(
      { name: "AES-GCM", iv },
      key,
      enc.encode(plain)
    );
    cipher = new Uint8Array(cipher);

    return `${base64(iv)}:${base64(salt)}:${base64(cipher)}`;
  }

  const decrypt = async (str, password) => {
    const [iv, salt, cipher] = str.split(":").map(debase64);

    const enc = new TextEncoder();
    const dec = new TextDecoder();
    const keyMaterial = await global.crypto.subtle.importKey(
      "raw", 
      enc.encode(password), 
      {name: "PBKDF2"}, 
      false, 
      ["deriveBits", "deriveKey"]
    );

    const key = await getKey(keyMaterial, salt);
    const r = await global.crypto.subtle.decrypt({name: "AES-GCM", iv}, key, cipher)

    return dec.decode(r);
  };

  if (typeof window !== 'undefined') {
    window.encrypt = encrypt;
    window.decrypt = decrypt;
  } else if (typeof module !== 'undefined') {
    module.exports = {encrypt, decrypt};
  } else {
    console.log("no window and no module... where are you running me?");
  }
})()
</script>
  </head>
  <body>
    <p>Private(1). This page contains private stuff. Feel free to hit me up for the password unless you're a bot.</p>
    <input id="password" type="password" />
    <button id="decrypt">Decrypt</button>

    <div id="encryptedContent" style="margin-top: 20px;">zOzUdUbMLqymov3z:PaEfndCi5K+ZN/D3/JTSyQ==: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</div>
    <script>
      const doDecrypt = async () => {
        const password = document.getElementById("password").value;
        const cipher = document.getElementById("encryptedContent").innerHTML;
        try {
          const plain = await decrypt(cipher, password);
          document.body.innerHTML = plain;
          // it was legit, so save it
        } catch(err) {
          console.log(err);
          alert("nope");
          return;
        }

        const passwordsStr = window.localStorage.getItem("passwords") || "{}";
        let passwords = JSON.parse(passwordsStr);
        passwords["1"] = password;
        window.localStorage.setItem("passwords", JSON.stringify(passwords));
      };
      document.getElementById("decrypt").addEventListener("click", doDecrypt);
      document.getElementById("password").addEventListener("keypress", (e) => {
        if (e.key === "Enter") {
          doDecrypt();
        }
      });

      // initial page load
      const passwordsStr = window.localStorage.getItem("passwords") || '{}';
      const passwords = JSON.parse(passwordsStr);
      if (passwords["1"]) {
        document.getElementById("password").value = passwords["1"];
      }
    </script>
  </body>
</html>
