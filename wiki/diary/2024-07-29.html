<!DOCTYPE html>
<html>
  <head>
    <link rel="Stylesheet" type="text/css" href="https://www.lukebergen.com/wiki/style.css">
    <link rel="alternate" type="application/rss+xml" title="RSS" href="rss.xml">
    <title>psych</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script>(() => {
  global = (typeof global === 'undefined') ? window : global;
  const base64 = (buffer) => {
    let binaryString = '';
    for (let i = 0; i < buffer.length; i++) {
      binaryString += String.fromCharCode(buffer[i]);
    }
    return global.btoa(binaryString);
  };

  const debase64 = (base64Str) => {
    const binaryString = atob(base64Str);
    
    // Create a Uint8Array from the binary string
    const uint8Array = new Uint8Array(binaryString.length);
    for (let i = 0; i < binaryString.length; i++) {
      uint8Array[i] = binaryString.charCodeAt(i);
    }

    // Create an ArrayBuffer from the Uint8Array
    return uint8Array;
  }

  const getKey = async (keyMaterial, salt) => {
    return global.crypto.subtle.deriveKey(
      {
        name: "PBKDF2",
        salt: salt, 
        iterations: 100000,
        hash: "SHA-256"
      },
      keyMaterial,
      { "name": "AES-GCM", "length": 256},
      true,
      [ "encrypt", "decrypt" ]
    );
  }

  const encrypt = async (plain, password) => {
    const enc = new TextEncoder();
    const keyMaterial = await global.crypto.subtle.importKey(
      "raw", 
      enc.encode(password), 
      {name: "PBKDF2"}, 
      false, 
      ["deriveBits", "deriveKey"]
    );

    salt = global.crypto.getRandomValues(new Uint8Array(16));

    const key = await getKey(keyMaterial, salt);

    iv = global.crypto.getRandomValues(new Uint8Array(12));

    cipher = await global.crypto.subtle.encrypt(
      { name: "AES-GCM", iv },
      key,
      enc.encode(plain)
    );
    cipher = new Uint8Array(cipher);

    return `${base64(iv)}:${base64(salt)}:${base64(cipher)}`;
  }

  const decrypt = async (str, password) => {
    const [iv, salt, cipher] = str.split(":").map(debase64);

    const enc = new TextEncoder();
    const dec = new TextDecoder();
    const keyMaterial = await global.crypto.subtle.importKey(
      "raw", 
      enc.encode(password), 
      {name: "PBKDF2"}, 
      false, 
      ["deriveBits", "deriveKey"]
    );

    const key = await getKey(keyMaterial, salt);
    const r = await global.crypto.subtle.decrypt({name: "AES-GCM", iv}, key, cipher)

    return dec.decode(r);
  };

  if (typeof window !== 'undefined') {
    window.encrypt = encrypt;
    window.decrypt = decrypt;
  } else if (typeof module !== 'undefined') {
    module.exports = {encrypt, decrypt};
  } else {
    console.log("no window and no module... where are you running me?");
  }
})()
</script>
  </head>
  <body>
    <p>Private(1). This page contains private stuff. Feel free to hit me up for the password unless you're a bot.</p>
    <input id="password" type="password" />
    <button id="decrypt">Decrypt</button>

    <div id="encryptedContent" style="margin-top: 20px;">XOg6g045NGrWVfmn:WXKZFudlalvE4jYuyPVhLg==:VamYow/YeWVDP3XrMWzF1hBSmewWjMoJxQTB8qUagjeMsw33v8S/d55U7RSR7Yb7mqYlKfOmY/EmjP+HvkFc+4LPH1xj1dYKCtMct83XGIqVsEIA9/RfBeteZlgPEW3BtHLu/CAPQYQV8E0dYd+e2iV21mdBjtxgxVsXdH6J5aJiyjlDxL56WWKw/5jbnocWY5IXwflaiA/bu6+MgEHUw19uCvIvARUXj2njbml2mEFB5LDkkel9clK0zTEpX55cgo6Owz/ofSWlQE/SpVMiPsCBnvAU14OHCQFhfRAZ0ZmwlaBRbXh7155OLgjKLzkU5+0hj76FOB+RCxTLStV7yY55w2sw2lQVbPs0y6Q/mmNsrLPcYMCX9VlEIhw5t1XIKYEy+gwvqzSsaItH+igyfhb+/lNYTSC7NCQOkgyXXdHu3+jCL9UTffeePtPpQyji4o0daG7JvM1guNaVyoleLldOJLKI1a7HLWvGpPam1AnshfFn1NQcYTU0GGaQpaKJQ95fQ6mXcKB1dKTo1iYA5r2dv8f/qBsZ5F0xybxwYHodfMSh+k8LlzkK8ZgPQnV5cgY2DfhZ0hKk7k8cBeMzHJRG/R2agnLiKpDCUG4O6NJRia2vixjX48z8NmojNdXgDdtaXzMdO+1hdG4+5XnA6hYHoCLEH1L79Cdtal/cRh1awGMZ14W5VVsySC9pFx3fZlha16+mZ5VRpqxfAkyAmvmCH0Uw2IkHmEFW/Zkg/i0Q3+QB6iN2bj4RTtLqmSp1fJJiyYWNhZKNA17g0EjizdkZEhqCT8aoiQZ/Wlobl5mYiD7BmdH2fvvtsW8iCfTK8LoSQhAGmigclz06n0IXsz4kY+JQ92oAyJNbJwTI82l04cM30ftbuDqAOyZs635OVUn2TjZDSoN1tbDKCNaSvMo7TElY7Tnk9eKjmsIHNk9F9PBvhcKaZXbX80M+fhH+igDRbpln0CtlUhcBnUUfjtqCfiRozfe1MWb683FjuPfj4QIqwEx1ra8fE0CeJ9BbBB1AFEStdv4YKM4wY4vRffZfqkAE6WPXdSCIFfNqMO4lBJEi/J0WgHmgqzqdFk76P90OSK6aoYLpLso1sGyaBIVFVH6ZSpUzfIKamKDlCR9nj37licbkvNUa/OKq9EJ8U/OddY0r+N3tDEsvaacLYUF+SoXGYyRaDM3hl4US9kAPQ+m3cAcvip0QdiorLK0Ux05UCX4bdWGKku/zp+MGNyMqIcsGLLxLj80t9WiFN9XFIgAy/PSkNEpVGj48Lqh2Dwxu3TjCIvkWhc9YYBBk4Bo+YIs6gM1iNwgO2Seak+c/1K7J6Ehhr/ZQey8Ya3Xo6r9/zt1Z7yZ/dVWTYjlmQn/N5pQgypgrEwL91ZA5uYOsgtBhCyHJ5V8sCMCoS2Ns/iCZZCqYlXolL9DvIrNXPcwSYaOktD54PPFstJ/4Epmrzv2we6Kf24hWKNwxzLWTlrgQ5OyUWcM6AvHrdcMuBJqphKZA43kkVJljwfjgKZG1h4AQtKXJRQg+xZrb3nmsFHAUothdAHI4r3DickWXTqOuBI7ICM5yFUVH2EFtjBayfGlniFmh9yNrkKqyzFFYs0HDaMXojkBfK6avZyLvVC3dp77lvR8vHZtJ8Mwa6ezJ/lXph7Z9ON9o9Mc0iw7WdZMYzt9J3luKYNacANOA1FIwzNzQXAENP7NNQrki8FxIQejiXnLyolbohbXp/amYiynXlYSPlB0CzCgGoSNPIwxl5S0O0ytSwtIb0FlWvJUmjtIFv4DimEp/jRPfHDhZPulLATYEsZ3Dq7V0HvVJdDq2yVUDRIA3ckQ4sBJdDHu8OFn2Xv57BcNL74P6DmCmah4BOJJCZTaKGU3Iy6Q6zZHcP+vbB0OIlY8soN12GSOEd8f8iw3qnkYNuC/d6yQCkaJWqdQ5kJI1A9JvzQN16cCDtAOV2ferw4vMSMICrPhDNmwdb2hjT1w8uI6W3cdTh8c/5cWYQwXqeFAwFcz7oQJXnlHapGIEJTAACwojqZftIM/CSI82NXXEby0lSIz6sUiSY+fNSRF1j/i8MzeTRO5YZciEowT5NZGtJQtvp2Ep04g9+xF/opRYDfINrizlz6nHSZ4nuMi4QHllGFQBlwHctfEEL5RNk+TEdqtptiifnHXXH2odjpg/82EMStzW24ZRzjny+0EceD2lN8tNYhF2wCDULTWdNQwjgXKEvr6JomSWCPftV/zHNhKQrPMyIvgOAPiFkUy/ilk/oVGxAGuHlw9lP9bMsbH4xnTgsBHi/21C49GLiDj8lC8FmtHjYRXypozAzTuXoptwjBvny05oj1d2P6fGPgGB/SqTzYVjBwSioJu1su303xympgByb611fvAvZriWcgTT1JkR8AUUT0KEYCA/dVMNdMUezZvjGtD6Lfl/VUkdKNuanRfH6b9b5BtfEnq5kC/ta1IwWSn8GwwL3jERVcB0oDjZI2GcyBGrFh14HfgOfHLzahGk9I8HN2Wun1zoY/HQXCqgYuBLF2ibuOZN+2EWyZOMUzTK7oZpUX6iDc/qCPsALvAdJ7Uc39xMeRboQTL6B1R5mFYViNfKAl79Med67Gr0Xa30SATfoGNUNCNzo8vjDhLBgO7aSJHaZl27bWa93Y18oTfl0wO4XyUVpgpRSsBVjvLHt+J4WF8u3Uge0u/ipCHf2AixvjUEcJbdL2SKS0eI2mGc5AJv25NY3TDwmXB12JckIk0D/Cvft/9oenO/rza9gSOuqm6WJUrqkRcGbZSzzgfDqlubEPS3zzV51LN7NA7fCWp/DpcoVrdGgJ10BGZ/sjv5ZG9uIGkyh4cDWdgI53SZqZ6SFZoVxxPTfeNj+iIZcSN3w26MyQoYQQnryR8zOxwCWh0VzTXoKgJsI4+zwzYgV3HCfcKcAzIoQRUB5R9rA0kvsG9t7nDAeG6NSPhpfFAn0/R3dcErLMDiFeXXrIMF0gFAkGaipwee+23yajMOtnzk1MlyXL7JDlg0cTWQFu23KwcUB8l3qPhI0GJbum8vblYCg+f1Hj85ZlSv</div>
    <script>
      const doDecrypt = async () => {
        const password = document.getElementById("password").value;
        const cipher = document.getElementById("encryptedContent").innerHTML;
        try {
          const plain = await decrypt(cipher, password);
          document.body.innerHTML = plain;
          // it was legit, so save it
        } catch(err) {
          console.log(err);
          alert("nope");
          return;
        }

        const passwordsStr = window.localStorage.getItem("passwords") || "{}";
        let passwords = JSON.parse(passwordsStr);
        passwords["1"] = password;
        window.localStorage.setItem("passwords", JSON.stringify(passwords));
      };
      document.getElementById("decrypt").addEventListener("click", doDecrypt);
      document.getElementById("password").addEventListener("keypress", (e) => {
        if (e.key === "Enter") {
          doDecrypt();
        }
      });

      // initial page load
      const passwordsStr = window.localStorage.getItem("passwords") || '{}';
      const passwords = JSON.parse(passwordsStr);
      if (passwords["1"]) {
        document.getElementById("password").value = passwords["1"];
      }
    </script>
  </body>
</html>
