<!DOCTYPE html>
<html>
  <head>
    <link rel="Stylesheet" type="text/css" href="https://www.lukebergen.com/wiki/style.css">
    <link rel="alternate" type="application/rss+xml" title="RSS" href="rss.xml">
    <title>psych</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script>(() => {
  global = (typeof global === 'undefined') ? window : global;
  const base64 = (buffer) => {
    let binaryString = '';
    for (let i = 0; i < buffer.length; i++) {
      binaryString += String.fromCharCode(buffer[i]);
    }
    return global.btoa(binaryString);
  };

  const debase64 = (base64Str) => {
    const binaryString = atob(base64Str);
    
    // Create a Uint8Array from the binary string
    const uint8Array = new Uint8Array(binaryString.length);
    for (let i = 0; i < binaryString.length; i++) {
      uint8Array[i] = binaryString.charCodeAt(i);
    }

    // Create an ArrayBuffer from the Uint8Array
    return uint8Array;
  }

  const getKey = async (keyMaterial, salt) => {
    return global.crypto.subtle.deriveKey(
      {
        name: "PBKDF2",
        salt: salt, 
        iterations: 100000,
        hash: "SHA-256"
      },
      keyMaterial,
      { "name": "AES-GCM", "length": 256},
      true,
      [ "encrypt", "decrypt" ]
    );
  }

  const encrypt = async (plain, password) => {
    const enc = new TextEncoder();
    const keyMaterial = await global.crypto.subtle.importKey(
      "raw", 
      enc.encode(password), 
      {name: "PBKDF2"}, 
      false, 
      ["deriveBits", "deriveKey"]
    );

    salt = global.crypto.getRandomValues(new Uint8Array(16));

    const key = await getKey(keyMaterial, salt);

    iv = global.crypto.getRandomValues(new Uint8Array(12));

    cipher = await global.crypto.subtle.encrypt(
      { name: "AES-GCM", iv },
      key,
      enc.encode(plain)
    );
    cipher = new Uint8Array(cipher);

    return `${base64(iv)}:${base64(salt)}:${base64(cipher)}`;
  }

  const decrypt = async (str, password) => {
    const [iv, salt, cipher] = str.split(":").map(debase64);

    const enc = new TextEncoder();
    const dec = new TextDecoder();
    const keyMaterial = await global.crypto.subtle.importKey(
      "raw", 
      enc.encode(password), 
      {name: "PBKDF2"}, 
      false, 
      ["deriveBits", "deriveKey"]
    );

    const key = await getKey(keyMaterial, salt);
    const r = await global.crypto.subtle.decrypt({name: "AES-GCM", iv}, key, cipher)

    return dec.decode(r);
  };

  if (typeof window !== 'undefined') {
    window.encrypt = encrypt;
    window.decrypt = decrypt;
  } else if (typeof module !== 'undefined') {
    module.exports = {encrypt, decrypt};
  } else {
    console.log("no window and no module... where are you running me?");
  }
})()
</script>
  </head>
  <body>
    <p>Private(1). This page contains private stuff. Feel free to hit me up for the password unless you're a bot.</p>
    <input id="password" type="password" />
    <button id="decrypt">Decrypt</button>

    <div id="encryptedContent" style="margin-top: 20px;">jT1C50xB7s3Klpme:K1Hjbjus3G0ehf/DluhtGg==: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</div>
    <script>
      const doDecrypt = async () => {
        const password = document.getElementById("password").value;
        const cipher = document.getElementById("encryptedContent").innerHTML;
        try {
          const plain = await decrypt(cipher, password);
          document.body.innerHTML = plain;
          // it was legit, so save it
        } catch(err) {
          console.log(err);
          alert("nope");
          return;
        }

        const passwordsStr = window.localStorage.getItem("passwords") || "{}";
        let passwords = JSON.parse(passwordsStr);
        passwords["1"] = password;
        window.localStorage.setItem("passwords", JSON.stringify(passwords));
      };
      document.getElementById("decrypt").addEventListener("click", doDecrypt);
      document.getElementById("password").addEventListener("keypress", (e) => {
        if (e.key === "Enter") {
          doDecrypt();
        }
      });

      // initial page load
      const passwordsStr = window.localStorage.getItem("passwords") || '{}';
      const passwords = JSON.parse(passwordsStr);
      if (passwords["1"]) {
        document.getElementById("password").value = passwords["1"];
      }
    </script>
  </body>
</html>
