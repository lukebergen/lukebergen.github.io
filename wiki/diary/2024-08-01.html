<!DOCTYPE html>
<html>
  <head>
    <link rel="Stylesheet" type="text/css" href="https://www.lukebergen.com/wiki/style.css">
    <link rel="alternate" type="application/rss+xml" title="RSS" href="rss.xml">
    <title>psych</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script>(() => {
  global = (typeof global === 'undefined') ? window : global;
  const base64 = (buffer) => {
    let binaryString = '';
    for (let i = 0; i < buffer.length; i++) {
      binaryString += String.fromCharCode(buffer[i]);
    }
    return global.btoa(binaryString);
  };

  const debase64 = (base64Str) => {
    const binaryString = atob(base64Str);
    
    // Create a Uint8Array from the binary string
    const uint8Array = new Uint8Array(binaryString.length);
    for (let i = 0; i < binaryString.length; i++) {
      uint8Array[i] = binaryString.charCodeAt(i);
    }

    // Create an ArrayBuffer from the Uint8Array
    return uint8Array;
  }

  const getKey = async (keyMaterial, salt) => {
    return global.crypto.subtle.deriveKey(
      {
        name: "PBKDF2",
        salt: salt, 
        iterations: 100000,
        hash: "SHA-256"
      },
      keyMaterial,
      { "name": "AES-GCM", "length": 256},
      true,
      [ "encrypt", "decrypt" ]
    );
  }

  const encrypt = async (plain, password) => {
    const enc = new TextEncoder();
    const keyMaterial = await global.crypto.subtle.importKey(
      "raw", 
      enc.encode(password), 
      {name: "PBKDF2"}, 
      false, 
      ["deriveBits", "deriveKey"]
    );

    salt = global.crypto.getRandomValues(new Uint8Array(16));

    const key = await getKey(keyMaterial, salt);

    iv = global.crypto.getRandomValues(new Uint8Array(12));

    cipher = await global.crypto.subtle.encrypt(
      { name: "AES-GCM", iv },
      key,
      enc.encode(plain)
    );
    cipher = new Uint8Array(cipher);

    return `${base64(iv)}:${base64(salt)}:${base64(cipher)}`;
  }

  const decrypt = async (str, password) => {
    const [iv, salt, cipher] = str.split(":").map(debase64);

    const enc = new TextEncoder();
    const dec = new TextDecoder();
    const keyMaterial = await global.crypto.subtle.importKey(
      "raw", 
      enc.encode(password), 
      {name: "PBKDF2"}, 
      false, 
      ["deriveBits", "deriveKey"]
    );

    const key = await getKey(keyMaterial, salt);
    const r = await global.crypto.subtle.decrypt({name: "AES-GCM", iv}, key, cipher)

    return dec.decode(r);
  };

  if (typeof window !== 'undefined') {
    window.encrypt = encrypt;
    window.decrypt = decrypt;
  } else if (typeof module !== 'undefined') {
    module.exports = {encrypt, decrypt};
  } else {
    console.log("no window and no module... where are you running me?");
  }
})()
</script>
  </head>
  <body>
    <p>Private(1). This page contains private stuff. Feel free to hit me up for the password unless you're a bot.</p>
    <input id="password" type="password" />
    <button id="decrypt">Decrypt</button>

    <div id="encryptedContent" style="margin-top: 20px;">iNdZlaJIDANsFW3b:dKc7ATMMqmeNAzc7cvc1HQ==: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</div>
    <script>
      const doDecrypt = async () => {
        const password = document.getElementById("password").value;
        const cipher = document.getElementById("encryptedContent").innerHTML;
        try {
          const plain = await decrypt(cipher, password);
          document.body.innerHTML = plain;
          // it was legit, so save it
        } catch(err) {
          console.log(err);
          alert("nope");
          return;
        }

        const passwordsStr = window.localStorage.getItem("passwords") || "{}";
        let passwords = JSON.parse(passwordsStr);
        passwords["1"] = password;
        window.localStorage.setItem("passwords", JSON.stringify(passwords));
      };
      document.getElementById("decrypt").addEventListener("click", doDecrypt);
      document.getElementById("password").addEventListener("keypress", (e) => {
        if (e.key === "Enter") {
          doDecrypt();
        }
      });

      // initial page load
      const passwordsStr = window.localStorage.getItem("passwords") || '{}';
      const passwords = JSON.parse(passwordsStr);
      if (passwords["1"]) {
        document.getElementById("password").value = passwords["1"];
      }
    </script>
  </body>
</html>
