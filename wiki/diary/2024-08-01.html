<!DOCTYPE html>
<html>
  <head>
    <link rel="Stylesheet" type="text/css" href="https://www.lukebergen.com/wiki/style.css">
    <link rel="alternate" type="application/rss+xml" title="RSS" href="rss.xml">
    <title>psych</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script>(() => {
  global = (typeof global === 'undefined') ? window : global;
  const base64 = (buffer) => {
    let binaryString = '';
    for (let i = 0; i < buffer.length; i++) {
      binaryString += String.fromCharCode(buffer[i]);
    }
    return global.btoa(binaryString);
  };

  const debase64 = (base64Str) => {
    const binaryString = atob(base64Str);
    
    // Create a Uint8Array from the binary string
    const uint8Array = new Uint8Array(binaryString.length);
    for (let i = 0; i < binaryString.length; i++) {
      uint8Array[i] = binaryString.charCodeAt(i);
    }

    // Create an ArrayBuffer from the Uint8Array
    return uint8Array;
  }

  const getKey = async (keyMaterial, salt) => {
    return global.crypto.subtle.deriveKey(
      {
        name: "PBKDF2",
        salt: salt, 
        iterations: 100000,
        hash: "SHA-256"
      },
      keyMaterial,
      { "name": "AES-GCM", "length": 256},
      true,
      [ "encrypt", "decrypt" ]
    );
  }

  const encrypt = async (plain, password) => {
    const enc = new TextEncoder();
    const keyMaterial = await global.crypto.subtle.importKey(
      "raw", 
      enc.encode(password), 
      {name: "PBKDF2"}, 
      false, 
      ["deriveBits", "deriveKey"]
    );

    salt = global.crypto.getRandomValues(new Uint8Array(16));

    const key = await getKey(keyMaterial, salt);

    iv = global.crypto.getRandomValues(new Uint8Array(12));

    cipher = await global.crypto.subtle.encrypt(
      { name: "AES-GCM", iv },
      key,
      enc.encode(plain)
    );
    cipher = new Uint8Array(cipher);

    return `${base64(iv)}:${base64(salt)}:${base64(cipher)}`;
  }

  const decrypt = async (str, password) => {
    const [iv, salt, cipher] = str.split(":").map(debase64);

    const enc = new TextEncoder();
    const dec = new TextDecoder();
    const keyMaterial = await global.crypto.subtle.importKey(
      "raw", 
      enc.encode(password), 
      {name: "PBKDF2"}, 
      false, 
      ["deriveBits", "deriveKey"]
    );

    const key = await getKey(keyMaterial, salt);
    const r = await global.crypto.subtle.decrypt({name: "AES-GCM", iv}, key, cipher)

    return dec.decode(r);
  };

  if (typeof window !== 'undefined') {
    window.encrypt = encrypt;
    window.decrypt = decrypt;
  } else if (typeof module !== 'undefined') {
    module.exports = {encrypt, decrypt};
  } else {
    console.log("no window and no module... where are you running me?");
  }
})()
</script>
  </head>
  <body>
    <p>Private(1). This page contains private stuff. Feel free to hit me up for the password unless you're a bot.</p>
    <input id="password" type="password" />
    <button id="decrypt">Decrypt</button>

    <div id="encryptedContent" style="margin-top: 20px;">Bz+TUUiPo+igwz/N:OXlKvDD+SeK2krwFnPDxBw==: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</div>
    <script>
      const doDecrypt = async () => {
        const password = document.getElementById("password").value;
        const cipher = document.getElementById("encryptedContent").innerHTML;
        try {
          const plain = await decrypt(cipher, password);
          document.body.innerHTML = plain;
          // it was legit, so save it
        } catch(err) {
          console.log(err);
          alert("nope");
          return;
        }

        const passwordsStr = window.localStorage.getItem("passwords") || "{}";
        let passwords = JSON.parse(passwordsStr);
        passwords["1"] = password;
        window.localStorage.setItem("passwords", JSON.stringify(passwords));
      };
      document.getElementById("decrypt").addEventListener("click", doDecrypt);
      document.getElementById("password").addEventListener("keypress", (e) => {
        if (e.key === "Enter") {
          doDecrypt();
        }
      });

      // initial page load
      const passwordsStr = window.localStorage.getItem("passwords") || '{}';
      const passwords = JSON.parse(passwordsStr);
      if (passwords["1"]) {
        document.getElementById("password").value = passwords["1"];
      }
    </script>
  </body>
</html>
