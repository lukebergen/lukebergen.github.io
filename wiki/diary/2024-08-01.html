<!DOCTYPE html>
<html>
  <head>
    <link rel="Stylesheet" type="text/css" href="https://www.lukebergen.com/wiki/style.css">
    <link rel="alternate" type="application/rss+xml" title="RSS" href="rss.xml">
    <title>psych</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script>(() => {
  global = (typeof global === 'undefined') ? window : global;
  const base64 = (buffer) => {
    let binaryString = '';
    for (let i = 0; i < buffer.length; i++) {
      binaryString += String.fromCharCode(buffer[i]);
    }
    return global.btoa(binaryString);
  };

  const debase64 = (base64Str) => {
    const binaryString = atob(base64Str);
    
    // Create a Uint8Array from the binary string
    const uint8Array = new Uint8Array(binaryString.length);
    for (let i = 0; i < binaryString.length; i++) {
      uint8Array[i] = binaryString.charCodeAt(i);
    }

    // Create an ArrayBuffer from the Uint8Array
    return uint8Array;
  }

  const getKey = async (keyMaterial, salt) => {
    return global.crypto.subtle.deriveKey(
      {
        name: "PBKDF2",
        salt: salt, 
        iterations: 100000,
        hash: "SHA-256"
      },
      keyMaterial,
      { "name": "AES-GCM", "length": 256},
      true,
      [ "encrypt", "decrypt" ]
    );
  }

  const encrypt = async (plain, password) => {
    const enc = new TextEncoder();
    const keyMaterial = await global.crypto.subtle.importKey(
      "raw", 
      enc.encode(password), 
      {name: "PBKDF2"}, 
      false, 
      ["deriveBits", "deriveKey"]
    );

    salt = global.crypto.getRandomValues(new Uint8Array(16));

    const key = await getKey(keyMaterial, salt);

    iv = global.crypto.getRandomValues(new Uint8Array(12));

    cipher = await global.crypto.subtle.encrypt(
      { name: "AES-GCM", iv },
      key,
      enc.encode(plain)
    );
    cipher = new Uint8Array(cipher);

    return `${base64(iv)}:${base64(salt)}:${base64(cipher)}`;
  }

  const decrypt = async (str, password) => {
    const [iv, salt, cipher] = str.split(":").map(debase64);

    const enc = new TextEncoder();
    const dec = new TextDecoder();
    const keyMaterial = await global.crypto.subtle.importKey(
      "raw", 
      enc.encode(password), 
      {name: "PBKDF2"}, 
      false, 
      ["deriveBits", "deriveKey"]
    );

    const key = await getKey(keyMaterial, salt);
    const r = await global.crypto.subtle.decrypt({name: "AES-GCM", iv}, key, cipher)

    return dec.decode(r);
  };

  if (typeof window !== 'undefined') {
    window.encrypt = encrypt;
    window.decrypt = decrypt;
  } else if (typeof module !== 'undefined') {
    module.exports = {encrypt, decrypt};
  } else {
    console.log("no window and no module... where are you running me?");
  }
})()
</script>
  </head>
  <body>
    <p>Private(1). This page contains private stuff. Feel free to hit me up for the password unless you're a bot.</p>
    <input id="password" type="password" />
    <button id="decrypt">Decrypt</button>

    <div id="encryptedContent" style="margin-top: 20px;">xBzHGxsVbhpKbbaU:YKyMMDzzfo8ibSIol6jwdw==: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</div>
    <script>
      const doDecrypt = async () => {
        const password = document.getElementById("password").value;
        const cipher = document.getElementById("encryptedContent").innerHTML;
        try {
          const plain = await decrypt(cipher, password);
          document.body.innerHTML = plain;
          // it was legit, so save it
        } catch(err) {
          console.log(err);
          alert("nope");
          return;
        }

        const passwordsStr = window.localStorage.getItem("passwords") || "{}";
        let passwords = JSON.parse(passwordsStr);
        passwords["1"] = password;
        window.localStorage.setItem("passwords", JSON.stringify(passwords));
      };
      document.getElementById("decrypt").addEventListener("click", doDecrypt);
      document.getElementById("password").addEventListener("keypress", (e) => {
        if (e.key === "Enter") {
          doDecrypt();
        }
      });

      // initial page load
      const passwordsStr = window.localStorage.getItem("passwords") || '{}';
      const passwords = JSON.parse(passwordsStr);
      if (passwords["1"]) {
        document.getElementById("password").value = passwords["1"];
      }
    </script>
  </body>
</html>
