<!DOCTYPE html>
<html>
  <head>
    <link rel="Stylesheet" type="text/css" href="https://www.lukebergen.com/wiki/style.css">
    <link rel="alternate" type="application/rss+xml" title="RSS" href="rss.xml">
    <title>psych</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script>(() => {
  global = (typeof global === 'undefined') ? window : global;
  const base64 = (buffer) => {
    let binaryString = '';
    for (let i = 0; i < buffer.length; i++) {
      binaryString += String.fromCharCode(buffer[i]);
    }
    return global.btoa(binaryString);
  };

  const debase64 = (base64Str) => {
    const binaryString = atob(base64Str);
    
    // Create a Uint8Array from the binary string
    const uint8Array = new Uint8Array(binaryString.length);
    for (let i = 0; i < binaryString.length; i++) {
      uint8Array[i] = binaryString.charCodeAt(i);
    }

    // Create an ArrayBuffer from the Uint8Array
    return uint8Array;
  }

  const getKey = async (keyMaterial, salt) => {
    return global.crypto.subtle.deriveKey(
      {
        name: "PBKDF2",
        salt: salt, 
        iterations: 100000,
        hash: "SHA-256"
      },
      keyMaterial,
      { "name": "AES-GCM", "length": 256},
      true,
      [ "encrypt", "decrypt" ]
    );
  }

  const encrypt = async (plain, password) => {
    const enc = new TextEncoder();
    const keyMaterial = await global.crypto.subtle.importKey(
      "raw", 
      enc.encode(password), 
      {name: "PBKDF2"}, 
      false, 
      ["deriveBits", "deriveKey"]
    );

    salt = global.crypto.getRandomValues(new Uint8Array(16));

    const key = await getKey(keyMaterial, salt);

    iv = global.crypto.getRandomValues(new Uint8Array(12));

    cipher = await global.crypto.subtle.encrypt(
      { name: "AES-GCM", iv },
      key,
      enc.encode(plain)
    );
    cipher = new Uint8Array(cipher);

    return `${base64(iv)}:${base64(salt)}:${base64(cipher)}`;
  }

  const decrypt = async (str, password) => {
    const [iv, salt, cipher] = str.split(":").map(debase64);

    const enc = new TextEncoder();
    const dec = new TextDecoder();
    const keyMaterial = await global.crypto.subtle.importKey(
      "raw", 
      enc.encode(password), 
      {name: "PBKDF2"}, 
      false, 
      ["deriveBits", "deriveKey"]
    );

    const key = await getKey(keyMaterial, salt);
    const r = await global.crypto.subtle.decrypt({name: "AES-GCM", iv}, key, cipher)

    return dec.decode(r);
  };

  if (typeof window !== 'undefined') {
    window.encrypt = encrypt;
    window.decrypt = decrypt;
  } else if (typeof module !== 'undefined') {
    module.exports = {encrypt, decrypt};
  } else {
    console.log("no window and no module... where are you running me?");
  }
})()
</script>
  </head>
  <body>
    <p>Private(2). This page contains private stuff. Feel free to hit me up for the password unless you're a bot.</p>
    <input id="password" type="password" />
    <button id="decrypt">Decrypt</button>

    <div id="encryptedContent" style="margin-top: 20px;">wLdm1tg9MvcBqx8H:vUpQD76Vdl8fX/c6JKqsrQ==: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</div>
    <script>
      const doDecrypt = async () => {
        const password = document.getElementById("password").value;
        const cipher = document.getElementById("encryptedContent").innerHTML;
        try {
          const plain = await decrypt(cipher, password);
          document.body.innerHTML = plain;
          // it was legit, so save it
        } catch(err) {
          console.log(err);
          alert("nope");
          return;
        }

        const passwordsStr = window.localStorage.getItem("passwords") || "{}";
        let passwords = JSON.parse(passwordsStr);
        passwords["2"] = password;
        window.localStorage.setItem("passwords", JSON.stringify(passwords));
      };
      document.getElementById("decrypt").addEventListener("click", doDecrypt);
      document.getElementById("password").addEventListener("keypress", (e) => {
        if (e.key === "Enter") {
          doDecrypt();
        }
      });

      // initial page load
      const passwordsStr = window.localStorage.getItem("passwords") || '{}';
      const passwords = JSON.parse(passwordsStr);
      if (passwords["2"]) {
        document.getElementById("password").value = passwords["2"];
      }
    </script>
  </body>
</html>
